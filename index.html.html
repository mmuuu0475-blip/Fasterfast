<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FasterDZ | Global Tech Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap');
        body { font-family: 'Cairo', sans-serif; background: #f0f2f5; color: #1e293b; margin: 0; overflow: hidden; }
        
        .main-container { max-width: 700px; margin: 0 auto; background: #f0f2f5; height: 100vh; position: relative; }
        
        .tab-content { display: none; height: calc(100vh - 140px); overflow-y: auto; padding: 15px; scrollbar-width: none; }
        .tab-content.active { display: block; }
        
        .nav-bar { background: white; border-top: 1px solid #e2e8f0; position: absolute; bottom: 0; width: 100%; display: flex; justify-content: space-around; padding: 10px 5px; z-index: 100; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); }
        .nav-item { display: flex; flex-direction: column; align-items: center; cursor: pointer; color: #65676b; flex: 1; transition: 0.2s; }
        .nav-item i { font-size: 1.4rem; }
        .nav-item span { font-size: 10px; font-weight: bold; margin-top: 2px; }
        .nav-item.active { color: #1877f2; }

        .post-card { background: white; border-radius: 12px; margin-bottom: 15px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); overflow: hidden; }
        .post-media { width: 100%; max-height: 450px; object-fit: contain; background: #000; display: block; margin: 0 auto; }
        
        .prayer-card { background: linear-gradient(135deg, #1877f2, #3b5998); color: white; padding: 12px; border-radius: 12px; margin-bottom: 15px; }
        .dua-bar { background: #e7f3ff; color: #1877f2; padding: 10px; border-radius: 8px; margin-bottom: 10px; text-align: center; font-weight: bold; font-size: 14px; }
        
        .modal { display: none; position: fixed; z-index: 500; inset: 0; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; padding: 20px; }
        .modal.active { display: flex; }
        
        .msg-me { background: #0084ff; color: white; align-self: flex-end; border-radius: 18px 18px 4px 18px; padding: 8px 14px; max-width: 80%; margin-bottom: 5px; }
        .msg-other { background: #e4e6eb; color: black; align-self: flex-start; border-radius: 18px 18px 18px 4px; padding: 8px 14px; max-width: 80%; margin-bottom: 5px; }
        
        #upload-progress { display: none; height: 4px; background: #e4e6eb; width: 100%; margin-top: 8px; border-radius: 2px; overflow: hidden; }
        #progress-fill { height: 100%; background: #1877f2; width: 0%; transition: 0.3s; }
        
        .recording { color: red !important; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        .comment-box { background: #f0f2f5; border-radius: 10px; padding: 8px; margin-top: 5px; font-size: 12px; }

        /* Ø²Ø± Ø§Ù„ØªØ¨Ø±Ø¹ Ø§Ù„Ø¬Ø°Ø§Ø¨ */
        .donate-btn-cool {
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
            color: white; font-weight: bold; border-radius: 15px;
            box-shadow: 0 4px 15px rgba(245, 87, 108, 0.4);
            transition: 0.3s;
        }
        .donate-btn-cool:hover { transform: scale(1.05); }

        /* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø© (Ø¨Ø¯ÙˆÙ† Ù…Ù„Ø§Ù…Ø­) */
        .user-avatar-placeholder {
            background: #e2e8f0; color: #94a3b8;
            display: flex; align-items: center; justify-content: center;
            border-radius: 50%; overflow: hidden;
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ù„Ø¯Ø®ÙˆÙ„ */
        #auth-screen { background: white; }
    </style>
</head>
<body>

<div class="main-container shadow-2xl">
    <header class="p-4 flex justify-between items-center bg-white border-b z-50">
        <div>
            <h2 class="text-2xl font-black text-[#1877f2] italic">FasterDZ</h2>
            <p id="live-clock" class="text-[10px] font-bold text-gray-500"></p>
        </div>
        <div class="flex gap-2">
            <button onclick="document.getElementById('donate-modal').classList.add('active')" class="p-2 donate-btn-cool text-white rounded-lg text-xs"><i class="fas fa-heart"></i> ØªØ¨Ø±Ø¹</button>
            <button onclick="logout()" class="p-2 bg-red-50 text-red-500 rounded-lg text-xs shadow-sm"><i class="fas fa-power-off"></i></button>
        </div>
    </header>

    <div id="donate-modal" class="modal" onclick="this.classList.remove('active')">
        <div class="bg-white p-8 rounded-3xl shadow-2xl text-center border relative" onclick="event.stopPropagation()">
            <div class="text-5xl mb-4">ğŸ</div>
            <h3 class="font-black text-xl mb-4 text-gray-800">Ø§Ø¯Ø¹Ù… ØªØ·ÙˆÙŠØ± FasterDZ</h3>
            <p class="text-sm text-gray-600 mb-6 leading-relaxed">
                ØªØ¨Ø±Ø¹ Ø¨Ø±ØµÙŠØ¯ Ù„ØµØ¯ÙŠÙ‚Ùƒ Ø§Ù„Ù…Ø·ÙˆØ± ÙˆØ³Ø§Ø¹Ø¯ ÙÙŠ Ø¨Ù†Ø§Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚<br>
                Ø£Ø±Ø³Ù„ Ø§Ù„Ø±ØµÙŠØ¯ Ù„Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ§Ù„ÙŠ:<br>
                <span class="inline-block mt-2 bg-blue-50 text-blue-700 px-4 py-2 rounded-xl font-black text-2xl tracking-widest">0773089512</span>
            </p>
            <button onclick="this.parentElement.parentElement.classList.remove('active')" class="w-full bg-gray-900 text-white py-3 rounded-xl font-bold">Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ</button>
        </div>
    </div>

    <div id="auth-screen" class="fixed inset-0 z-[300] flex items-center justify-center p-6">
        <div class="bg-white p-10 rounded-[3rem] w-full max-w-sm text-center shadow-2xl border">
            <div class="w-20 h-20 bg-blue-50 rounded-3xl mx-auto mb-6 flex items-center justify-center text-3xl text-blue-600 shadow-inner">
                <i class="fas fa-bolt"></i>
            </div>
            <h1 class="text-4xl font-black text-[#1877f2] mb-2 tracking-tighter">FasterDZ</h1>
            <p class="text-gray-400 text-sm mb-10 font-bold italic">Innovation Start Here</p>
<button onclick="loginWithGoogle()" class="w-full bg-white border-2 border-gray-100 p-4 rounded-2xl font-bold flex items-center justify-center gap-4 hover:bg-gray-50 transition-all shadow-sm">
    <svg width="20" height="20" viewBox="0 0 48 48">
        <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path>
        <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"></path>
        <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24s.92 7.54 2.56 10.78l7.97-6.19z"></path>
        <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path>
    </svg>
    ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Ø¬ÙˆØ¬Ù„
</button>
        </div>
    </div>

    <div id="setup-profile-screen" class="fixed inset-0 z-[400] bg-white flex flex-col items-center justify-center p-6 hidden">
        <div class="w-full max-w-sm text-center">
            <h2 class="text-2xl font-black mb-8 text-gray-800">ØªØ®ØµÙŠØµ Ù…Ù„ÙÙƒ Ø§Ù„Ø´Ø®ØµÙŠ</h2>
            <div class="relative w-32 h-32 mx-auto mb-8">
                <img id="setup-avatar" src="" class="w-full h-full rounded-full object-cover border-4 border-blue-500 p-1">
                <label class="absolute bottom-0 right-0 bg-blue-600 text-white p-2 rounded-full cursor-pointer shadow-lg">
                    <i class="fas fa-camera text-sm"></i>
                    <input type="file" id="profile-img-upload" class="hidden" accept="image/*" onchange="previewProfileImg()">
                </label>
            </div>
            <input type="text" id="setup-display-name" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„Ù…Ø³ØªØ¹Ø§Ø±" class="w-full p-4 bg-gray-50 rounded-2xl mb-4 border focus:border-blue-500 outline-none font-bold text-center">
            <button onclick="saveNewProfile()" id="save-profile-btn" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-black shadow-lg shadow-blue-200">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†</button>
        </div>
    </div>

    <main>
        <div id="tab-home" class="tab-content active">
            <div class="prayer-card shadow-sm flex justify-between items-center">
                <div><i class="fas fa-mosque ml-2"></i> Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©: <span id="next-prayer-time" class="font-black">--:--</span></div>
                <div class="bg-white/20 px-2 py-1 rounded text-[10px]">ØªÙˆÙ‚ÙŠØª DZ</div>
            </div>
            <div class="dua-bar shadow-sm"><i class="fas fa-heart ml-2"></i> <span id="dua-text">Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø­Ù…Ø¯Ù‡</span></div>

            <div class="post-card p-4">
                <div class="flex gap-3 mb-3">
                    <img id="post-user-img" src="" class="w-10 h-10 rounded-full border">
                    <textarea id="post-text" placeholder="Ø¨Ù…Ø§Ø°Ø§ ØªÙÙƒØ± Ø§Ù„ÙŠÙˆÙ…ØŸ" class="w-full outline-none h-16 resize-none text-md pt-2"></textarea>
                </div>
                <div id="upload-progress"><div id="progress-fill"></div></div>
                <div class="flex justify-between items-center mt-3 pt-3 border-t">
                    <div class="flex gap-4">
                        <label class="text-green-500 font-bold cursor-pointer text-sm flex items-center gap-1">
                            <i class="fas fa-images text-lg"></i> ØµÙˆØ±/ÙÙŠØ¯ÙŠÙˆ
                            <input type="file" id="post-file" class="hidden" accept="image/*,video/*">
                        </label>
                        <button onclick="startVoice('post-text')" class="text-gray-400"><i class="fas fa-microphone text-lg"></i></button>
                    </div>
                    <button id="upload-btn" onclick="uploadToCloudinary()" class="bg-[#1877f2] text-white px-6 py-1.5 rounded-md font-bold text-sm shadow-md">Ù†Ø´Ø±</button>
                </div>
            </div>
            <div id="posts-list" class="space-y-4 pb-20"></div>
        </div>

        <div id="tab-search" class="tab-content">
            <input type="text" id="search-in" oninput="searchUsers()" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø¨Ø±Ù…Ø¬ÙŠÙ† Ø£Ùˆ Ø£ØµØ¯Ù‚Ø§Ø¡..." class="w-full p-4 bg-white rounded-full shadow-sm outline-none mb-4 border">
            <div id="search-results" class="space-y-2"></div>
        </div>

        <div id="tab-msgs" class="tab-content">
            <h3 class="font-bold mb-4 text-xl">Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</h3>
            <div id="chats-list" class="space-y-2"></div>
        </div>

        <div id="tab-groups" class="tab-content">
            <div class="bg-white p-4 rounded-xl border mb-4">
                <input type="text" id="g-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©" class="w-full p-2 border rounded mb-2">
                <button onclick="createGroup()" class="w-full bg-[#1877f2] text-white py-2 rounded font-bold">Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù…ÙˆØ¹Ø©</button>
            </div>
            <div id="groups-list" class="space-y-2"></div>
        </div>

        <div id="tab-profile" class="tab-content">
            <div class="bg-white p-8 rounded-3xl text-center shadow-sm mb-4 border relative">
                <button onclick="editProfile()" class="absolute top-4 left-4 text-gray-400"><i class="fas fa-edit"></i></button>
                <img id="me-avatar" src="" class="w-24 h-24 rounded-full mx-auto mb-4 object-cover border-4 border-white shadow-lg">
                <h3 id="me-name" class="font-bold text-2xl text-gray-800">...</h3>
                <p id="me-email" class="text-gray-400 text-xs tracking-wide">...</p>
                <div class="mt-6 flex justify-center gap-8 border-t pt-4">
                    <div><b id="count-following" class="text-lg">0</b><p class="text-[10px] text-gray-500 uppercase font-black">Ù…ØªØ§Ø¨Ø¹Ø©</p></div>
                </div>
            </div>
            
            <div class="grid grid-cols-2 gap-3 mb-6">
                <a href="https://www.youtube.com/@omto123" target="_blank" class="flex items-center justify-center gap-2 p-3 bg-red-600 text-white rounded-xl font-bold shadow-md"><i class="fab fa-youtube"></i> ÙŠÙˆØªÙŠÙˆØ¨</a>
                <button onclick="document.getElementById('donate-modal').classList.add('active')" class="p-3 bg-orange-500 text-white rounded-xl font-bold shadow-md"><i class="fas fa-bullhorn"></i> ØªØ±ÙˆÙŠØ¬</button>
            </div>

            <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
                <h4 class="font-black text-blue-600 mb-3 border-b pb-2 text-sm uppercase">ØªÙˆØ§ØµÙ„ Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹</h4>
                <div class="space-y-3">
                    <p class="flex items-center gap-3 text-sm font-semibold"><i class="fas fa-envelope text-blue-500"></i> mmuuu0475@gmail.com</p>
                    <p class="flex items-center gap-3 text-sm font-semibold"><i class="fas fa-phone text-green-500"></i> 0655201033</p>
                </div>
            </div>
            
            <button onclick="loadAllUsers()" class="w-full mt-4 bg-white text-[#1877f2] border-2 border-blue-50 font-black py-4 rounded-2xl shadow-sm">Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ø±Ù‚Ù…ÙŠ</button>
            <div id="all-users-list" class="mt-4 space-y-2 pb-20"></div>
        </div>
    </main>

    <nav class="nav-bar">
        <div class="nav-item active" id="btn-home" onclick="showTab('home')"><i class="fas fa-home"></i><span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></div>
        <div class="nav-item" id="btn-search" onclick="showTab('search')"><i class="fas fa-search"></i><span>Ø§Ù„Ø¨Ø­Ø«</span></div>
        <div class="nav-item" id="btn-msgs" onclick="showTab('msgs')"><i class="fas fa-comment-dots"></i><span>Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</span></div>
        <div class="nav-item" id="btn-groups" onclick="showTab('groups')"><i class="fas fa-users"></i><span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</span></div>
        <div class="nav-item" id="btn-profile" onclick="showTab('profile')"><i class="fas fa-user-circle"></i><span>Ø­Ø³Ø§Ø¨ÙŠ</span></div>
    </nav>

    <div id="chat-window" class="hidden fixed inset-0 z-[600] bg-white flex flex-col">
        <header class="p-4 border-b flex items-center gap-4 bg-white shadow-sm">
            <i class="fas fa-arrow-right text-[#1877f2] text-xl" onclick="closeChat()"></i>
            <div class="font-bold text-lg" id="chat-title">...</div>
        </header>
        <div id="chat-msgs" class="flex-1 overflow-y-auto p-4 flex flex-col gap-3 bg-[#f0f2f5]"></div>
        <div class="p-3 border-t flex flex-col gap-2 bg-white">
            <div id="chat-upload-info" class="hidden text-[10px] text-blue-600 font-bold px-2">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...</div>
            <div class="flex items-center gap-2">
                <label class="text-[#1877f2] cursor-pointer"><i class="fas fa-camera text-xl"></i><input type="file" id="chat-file" class="hidden" accept="image/*,video/*" onchange="sendChatMedia()"></label>
                <input type="text" id="chat-in" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©..." class="flex-1 p-3 bg-gray-100 rounded-full outline-none text-sm">
                <button onclick="startVoice('chat-in')" class="text-gray-400"><i class="fas fa-microphone"></i></button>
                <button onclick="sendChatTxt()" class="text-[#1877f2] text-2xl px-2"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCBzdLYDoh6PfA_n-xbxPpzFGPpxc8XZ4M",
        authDomain: "faster-dz.firebaseapp.com",
        projectId: "faster-dz",
        storageBucket: "faster-dz.appspot.com",
        messagingSenderId: "397497981530",
        appId: "1:397497981530:web:bfdce9d4de65f37d861663"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    const CLOUDINARY_URL = "https://api.cloudinary.com/v1_1/dknsyhnrb/upload";
    const CLOUDINARY_PRESET = "ml_default"; 

    let me = null;
    let activeChat = null;

    // --- Google Auth ---
    function loginWithGoogle() {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithRedirect(provider);
    }

    auth.onAuthStateChanged(async (user) => {
        if (user) {
            const userDoc = await db.collection('v10_users').doc(user.uid).get();
            if (userDoc.exists) {
                me = userDoc.data();
                startApp();
            } else {
                // Ø£ÙˆÙ„ Ù…Ø±Ø© ÙŠØ¯Ø®Ù„
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('setup-profile-screen').classList.remove('hidden');
                document.getElementById('setup-avatar').src = user.photoURL || 'https://via.placeholder.com/150';
                document.getElementById('setup-display-name').value = user.displayName;
            }
        } else {
            document.getElementById('auth-screen').classList.remove('hidden');
            document.getElementById('app-content-area')?.classList.add('hidden');
        }
    });

    async function saveNewProfile() {
        const name = document.getElementById('setup-display-name').value;
        const user = auth.currentUser;
        if(!name) return alert("Ø§Ù„Ø§Ø³Ù… Ù…Ø·Ù„ÙˆØ¨");
        
        me = {
            id: user.uid,
            name: name,
            email: user.email,
            photo: user.photoURL,
            following: [],
            createdAt: Date.now()
        };
        await db.collection('v10_users').doc(user.uid).set(me);
        document.getElementById('setup-profile-screen').classList.add('hidden');
        startApp();
    }

    function startApp() {
        document.getElementById('auth-screen').classList.add('hidden');
        document.getElementById('me-name').innerText = me.name;
        document.getElementById('me-email').innerText = me.email;
        document.getElementById('me-avatar').src = me.photo || 'https://via.placeholder.com/150';
        document.getElementById('post-user-img').src = me.photo || 'https://via.placeholder.com/150';
        document.getElementById('count-following').innerText = (me.following || []).length;
        loadPosts(); 
        loadGroups();
    }

    function logout() { auth.signOut().then(() => location.reload()); }

    // --- Media Logic (Same as yours, fixed Cloudinary) ---
    async function uploadToCloudinary() {
        const file = document.getElementById('post-file').files[0];
        const text = document.getElementById('post-text').value;
        const btn = document.getElementById('upload-btn');
        const prog = document.getElementById('upload-progress');
        const fill = document.getElementById('progress-fill');

        if (!file && !text) return;

        if (file) {
            btn.disabled = true; prog.style.display = 'block';
            const formData = new FormData();
            formData.append('file', file);
            formData.append('upload_preset', CLOUDINARY_PRESET);

            const xhr = new XMLHttpRequest();
            xhr.open('POST', CLOUDINARY_URL, true);
            xhr.upload.onprogress = (e) => { fill.style.width = (e.loaded / e.total * 100) + '%'; };
            xhr.onload = async () => {
                if (xhr.status === 200) {
                    const res = JSON.parse(xhr.responseText);
                    savePost(text, res.secure_url, file.type.startsWith('video') ? 'video' : 'image');
                } else { alert("Ø¹Ø°Ø±Ø§Ù‹ØŒ ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹"); resetUpload(); }
            };
            xhr.send(formData);
        } else { savePost(text, "", "none"); }
    }

    async function savePost(text, url, type) {
        await db.collection('v10_posts').add({ 
            author: me.name, 
            uid: me.id, 
            avatar: me.photo,
            text, media: url, mediaType: type, 
            time: Date.now(), likes: 0, dislikes: 0, comments: []
        });
        resetUpload();
    }

    function loadPosts() {
        db.collection('v10_posts').orderBy('time', 'desc').onSnapshot(snap => {
            const list = document.getElementById('posts-list');
            list.innerHTML = '';
            snap.forEach(doc => {
                const p = doc.data();
                const postId = doc.id;
                let mediaTag = '';
                if(p.media) {
                    mediaTag = p.mediaType === 'video' ? `<video controls class="post-media"><source src="${p.media}"></video>` : `<img src="${p.media}" class="post-media" onerror="this.src='https://via.placeholder.com/400x200?text=FasterDZ+Media'">`;
                }

                list.innerHTML += `<div class="post-card">
                    <div class="p-3 flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <img src="${p.avatar || 'https://via.placeholder.com/50'}" class="w-10 h-10 rounded-full" onerror="this.src='https://cdn-icons-png.flaticon.com/512/149/149071.png'">
                            <div><div class="font-bold text-sm">${p.author}</div><div class="text-[10px] text-gray-500">${new Date(p.time).toLocaleString('ar-DZ')}</div></div>
                        </div>
                    </div>
                    ${p.text ? `<div class="px-3 pb-3 text-sm leading-relaxed">${p.text}</div>` : ''}
                    ${mediaTag}
                    <div class="p-3 border-t flex justify-between text-gray-500 text-sm">
                        <div class="flex gap-4">
                            <button onclick="handleReaction('${postId}', 'like')">ğŸŒ¸ ${p.likes || 0}</button>
                            <button onclick="handleReaction('${postId}', 'dislike')">ğŸ‚ ${p.dislikes || 0}</button>
                            <button><i class="far fa-comment"></i> ${p.comments ? p.comments.length : 0}</button>
                        </div>
                        <button onclick="sharePost('${postId}')" class="text-blue-500 font-bold"><i class="fas fa-link"></i></button>
                    </div>
                    <div class="px-3 pb-3">
                        <div class="flex gap-2">
                            <input type="text" id="comment-in-${postId}" placeholder="ØªØ¹Ù„ÙŠÙ‚..." class="flex-1 bg-gray-100 p-2 rounded-lg text-xs outline-none">
                            <button onclick="addComment('${postId}')" class="bg-blue-600 text-white px-3 rounded-lg text-xs">Ø§Ø±Ø³Ù„</button>
                        </div>
                    </div>
                </div>`;
            });
        });
    }

    // --- UI Logic ---
    function showTab(t) {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.getElementById('tab-'+t).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
        document.getElementById('btn-'+t).classList.add('active');
        if(t === 'msgs') loadFollowingChats();
    }

    function resetUpload() {
        document.getElementById('post-text').value = "";
        document.getElementById('post-file').value = "";
        document.getElementById('upload-progress').style.display = 'none';
        document.getElementById('upload-btn').disabled = false;
    }

    async function handleReaction(postId, type) {
        const postRef = db.collection('v10_posts').doc(postId);
        const doc = await postRef.get();
        if(doc.exists) {
            let data = doc.data();
            let update = {};
            if(type === 'like') update.likes = (data.likes || 0) + 1;
            else update.dislikes = (data.dislikes || 0) + 1;
            await postRef.update(update);
        }
    }

    async function addComment(postId) {
        const input = document.getElementById(`comment-in-${postId}`);
        const text = input.value.trim();
        if(!text) return;
        const postRef = db.collection('v10_posts').doc(postId);
        const doc = await postRef.get();
        if(doc.exists) {
            let comments = doc.data().comments || [];
            comments.push({ user: me.name, text: text, time: Date.now() });
            await postRef.update({ comments });
            input.value = '';
        }
    }

    async function loadGroups() {
        db.collection('v10_groups').onSnapshot(snap => {
            const list = document.getElementById('groups-list'); list.innerHTML = '';
            snap.forEach(doc => { list.innerHTML += `<div class="p-4 bg-white rounded-xl shadow-sm font-bold border-r-4 border-blue-600 mb-2">${doc.data().name}</div>`; });
        });
    }

    function createGroup() {
        const n = document.getElementById('g-name').value;
        if(n) db.collection('v10_groups').add({ name: n, time: Date.now() });
        document.getElementById('g-name').value = '';
    }

    function startVoice(targetId) {
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'ar-SA';
        recognition.onresult = (e) => { document.getElementById(targetId).value = e.results[0][0].transcript; };
        recognition.start();
    }

    function updatePrayerTimes() {
        const now = new Date();
        document.getElementById('live-clock').innerText = now.toLocaleTimeString('ar-DZ');
        document.getElementById('next-prayer-time').innerText = "05:42"; 
    }
    setInterval(updatePrayerTimes, 1000);

    function sharePost(postId) {
        navigator.clipboard.writeText(window.location.href);
        alert("ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ·Ø¨ÙŠÙ‚!");
    }
</script>
</body>
</html>